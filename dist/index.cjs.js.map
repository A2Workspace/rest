{"version":3,"file":"index.cjs.js","sources":["../src/core/mergeConfig.js","../src/core/captures.js","../src/core/RestPromise.js","../src/core/Rest.js","../src/defaults.js","../src/index.js"],"sourcesContent":["\r\nconst mergeMap = {\r\n  method: '',\r\n  url: '',\r\n  data: {},\r\n  params: {},\r\n};\r\n\r\n/**\r\n * 合併兩個設定值\r\n *\r\n * @param {Object} config1\r\n * @param {Object} config2\r\n * @returns {Object} 合併後的新物件\r\n */\r\nexport default function mergeConfig(config1, config2) {\r\n  config1 = accessible(config1);\r\n  config2 = accessible(config2);\r\n\r\n  let config = {};\r\n\r\n  for (const [prop, value] of Object.entries(mergeMap)) {\r\n    if (isAccessible(value)) {\r\n      config[prop] = mergeAccessible(value, config1[prop], config2[prop]);\r\n    } else {\r\n      config[prop] = config2[prop] || config1[prop] || value;\r\n    }\r\n  }\r\n\r\n  return config;\r\n}\r\n\r\n/**\r\n * 若給予的值不為可存取之物件，則回傳一個空物件。\r\n *\r\n * @param {*} value\r\n * @returns {Object}\r\n */\r\nexport function accessible(value) {\r\n  return isAccessible(value) ? value : {};\r\n}\r\n\r\n/**\r\n * 判斷是否為可存取之物件。\r\n *\r\n * @param {*} value\r\n * @returns {boolean}\r\n */\r\nexport function isAccessible(value) {\r\n  return typeof value === 'object' && value !== null;\r\n}\r\n\r\n/**\r\n * 淺合併多個物件。\r\n *\r\n * @param {any[]} ...args\r\n * @returns {Object}\r\n */\r\nexport function mergeAccessible(...args) {\r\n  return Object.assign({}, ...args.filter(isAccessible));\r\n}\r\n","\r\n/**\r\n * 捕獲 axiox 錯誤\r\n *\r\n * @param {AxiosErrorHandler} handler\r\n * @returns {ErrorCapturer}\r\n *\r\n * @example\r\n * ```js\r\n * axios.post(API_URI)\r\n *   .then((res) => res.data)\r\n *   .catch(captureAxiosError((res) => {\r\n *     console.log('請求失敗');\r\n *   }))\r\n *   .catch((error) => {\r\n *     console.error(error);\r\n *   })\r\n * ```\r\n */\r\nexport function captureAxiosError(handler) {\r\n  return function (error) {\r\n    if (error.isAxiosError) {\r\n      return handler(error);\r\n    }\r\n\r\n    throw error;\r\n  };\r\n}\r\n\r\n/**\r\n * 捕獲處理指定 http 狀態碼\r\n *\r\n * @param {(number|number[]|string|string[])} code\r\n * @param {AxiosErrorHandler} handler\r\n * @returns {ErrorCapturer}\r\n *\r\n * @example\r\n * ```js\r\n * axios.post(API_URI)\r\n *   .then((res) => res.data)\r\n *   .catch(captureStatusCode(401, (res) => {\r\n *     console.log('尚未登入');\r\n *   }))\r\n *   .catch(captureStatusCode(403, (res) => {\r\n *     console.log('沒有權限');\r\n *   }))\r\n * ```\r\n */\r\nexport function captureStatusCode(code, handler) {\r\n  let expected = Array.isArray(code) ? code : [code];\r\n\r\n  return function (error) {\r\n    let status = error.response?.status;\r\n\r\n    if (status && expected.includes(status)) {\r\n      return handler(error);\r\n    }\r\n\r\n    throw error;\r\n  };\r\n}\r\n\r\n/**\r\n * 捕獲驗證錯誤\r\n *\r\n * @param {(boolean|ValidationErrorHandler)} brief\r\n * @param {ValidationErrorHandler} [handler]\r\n * @returns {ErrorCapturer}\r\n *\r\n * @example\r\n * ```js\r\n * axios.post(API_URI)\r\n *   .then((res) => res.data)\r\n *   .catch(captureValidationError(({ message, errors }) => {\r\n *     this.errors = errors;\r\n *     alert(message);\r\n *   }))\r\n * ```\r\n */\r\nexport function captureValidationError(brief, handler) {\r\n  if (typeof brief === 'function') {\r\n    handler = brief;\r\n    brief = false;\r\n  }\r\n\r\n  return captureStatusCode(422, function (error) {\r\n    if (typeof handler !== 'function') {\r\n      return null;\r\n    }\r\n\r\n    let messageBag = brief ? new BriefValidationMessageBag(error.response) : new ValidationMessageBag(error.response);\r\n\r\n    return handler(messageBag);\r\n  });\r\n}\r\n\r\nclass ValidationMessageBag {\r\n  _response;\r\n  _message;\r\n  _errors;\r\n\r\n  /**\r\n   * @param {ValidationErrorResponse} response\r\n   */\r\n  constructor(response) {\r\n    this._response = response;\r\n    this._message = response.data.message || 'The given data was invalid';\r\n    this._errors = response.data.errors || {};\r\n\r\n    for (const [key, value] of Object.entries(this._errors)) {\r\n      this._errors[key] = Array.isArray(value) ? value : [value];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @returns {Object}\r\n   */\r\n  get response() {\r\n    return this._response;\r\n  }\r\n\r\n  /**\r\n   * @returns {string}\r\n   */\r\n  get message() {\r\n    return this._message;\r\n  }\r\n\r\n  /**\r\n   * @returns {Object.<string, string[]>}\r\n   */\r\n  get errors() {\r\n    return this._errors;\r\n  }\r\n\r\n  /**\r\n   * 取得第一筆錯誤訊息\r\n   *\r\n   * @param {string} [field]\r\n   * @returns {string}\r\n   */\r\n  first(field) {\r\n    for (const [key, value] of Object.entries(this._errors)) {\r\n      if (!field || field == key) {\r\n        return value[0];\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nclass BriefValidationMessageBag extends ValidationMessageBag {\r\n  /**\r\n   * @param {ValidationErrorResponse} response\r\n   */\r\n  constructor(response) {\r\n    super(response);\r\n\r\n    for (const [key, value] of Object.entries(this._errors)) {\r\n      this._errors[key] = value[0];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @returns {Object.<string, string>}\r\n   */\r\n  get errors() {\r\n    return this._errors;\r\n  }\r\n\r\n  /**\r\n   * 取得第一筆錯誤訊息\r\n   *\r\n   * @param {string} [field]\r\n   * @returns {string}\r\n   */\r\n  first(field) {\r\n    for (const [key, value] of Object.entries(this._errors)) {\r\n      if (!field || field == key) {\r\n        return value;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * @callback AxiosErrorHandler\r\n * @param {AxiosError} error\r\n * @returns {*}\r\n */\r\n\r\n/**\r\n * @callback ValidationErrorHandler\r\n * @param {(ValidationMessageBag|BriefValidationMessageBag)} error\r\n * @returns {*}\r\n */\r\n\r\n/**\r\n * @typedef ValidationErrorResponse\r\n * @type {object}\r\n * @property {number} status\r\n * @property {Object} data\r\n * @property {string} data.message\r\n * @property {Object.<string, string[]>} data.errors\r\n */\r\n\r\n/**\r\n * @callback ErrorCapturer\r\n * @param {*} error\r\n * @returns {void}\r\n */\r\n","import {\r\n  captureAxiosError,\r\n  captureStatusCode,\r\n  captureValidationError,\r\n} from './captures';\r\n\r\nexport default class RestPromise extends Promise {\r\n  /**\r\n   * @param {AxiosErrorHandler} handler\r\n   * @returns {RestPromise}\r\n   */\r\n  catchAxiosError(handler) {\r\n    return this.catch(captureAxiosError(handler));\r\n  }\r\n\r\n  /**\r\n   * @param {(number|number[]|string|string[])} code\r\n   * @param {AxiosErrorHandler} handler\r\n   * @returns {RestPromise}\r\n   */\r\n  catchStatusCode(code, handler) {\r\n    return this.catch(captureStatusCode(code, handler));\r\n  }\r\n\r\n  /**\r\n   * @param {(boolean|ValidationErrorHandler)} brief\r\n   * @param {ValidationErrorHandler} [handler]\r\n   * @returns {RestPromise}\r\n   */\r\n  catchValidationError(brief, handler) {\r\n    return this.catch(captureValidationError(brief, handler));\r\n  }\r\n}\r\n\r\n/**\r\n * @param {Promise} promise\r\n * @returns {RestPromise}\r\n */\r\nRestPromise.wrap = function (promise) {\r\n  if (promise instanceof Promise) {\r\n    return RestPromise.resolve(promise);\r\n  }\r\n\r\n  throw TypeError('傳入的參數必須為 Promise');\r\n};\r\n\r\n/**\r\n * @callback AxiosErrorHandler\r\n * @param {AxiosError} error\r\n * @returns {*}\r\n */\r\n\r\n/**\r\n * @callback ValidationErrorHandler\r\n * @param {(ValidationMessageBag|BriefValidationMessageBag)} error\r\n * @returns {*}\r\n */\r\n\r\n/**\r\n * @typedef ValidationErrorResponse\r\n * @type {object}\r\n * @property {number} status\r\n * @property {Object} data\r\n * @property {string} data.message\r\n * @property {Object.<string, string[]>} data.errors\r\n */\r\n","import axios from 'axios';\r\nimport mergeConfig from './mergeConfig';\r\nimport RestPromise from './RestPromise';\r\n\r\nexport default class Rest {\r\n  #resourceURN;\r\n  #options;\r\n  #axios;\r\n\r\n  /**\r\n   * @param {string} urn\r\n   * @param {RestOptions} options\r\n   */\r\n  constructor(urn, options = {}) {\r\n    this.#resourceURN = String(urn).replace(/\\/$/, '');\r\n    this.#axios = options.axios || axios;\r\n\r\n    this.#options = options;\r\n\r\n    bindDefaultActions(this);\r\n  }\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @param {bindActionHandler} callable\r\n   * @returns {void}\r\n   */\r\n  bindAction(name, callable) {\r\n    if (typeof this[name] !== 'undefined') {\r\n      throw new Error(`${name} 已存在`);\r\n    }\r\n\r\n    let actionOptions = this.#options[name];\r\n\r\n    let action = (...args) => {\r\n      let inputOptions = callable.call(action, ...args);\r\n\r\n      let config = mergeConfig(actionOptions, inputOptions);\r\n      config.url = callCustomParseURL(inputOptions, this.#resourceURN);\r\n\r\n      action.lastQuery = config;\r\n\r\n      return RestPromise.wrap(this.#axios.request(config));\r\n    };\r\n\r\n    action.options = actionOptions;\r\n    action.lastQuery = {};\r\n\r\n    this[name] = action;\r\n  }\r\n}\r\n\r\n/**\r\n * 綁定預設的 fetchAll, create, fetch, update, delete 等五個方法\r\n *\r\n * @param {Rest} restInstance\r\n * @returns {void}\r\n */\r\nfunction bindDefaultActions(restInstance) {\r\n  restInstance.bindAction('fetchAll', function (params = {}) {\r\n    if (typeof params === 'function') {\r\n      params = params(this.lastQuery.params);\r\n    }\r\n\r\n    if (typeof params !== 'object') {\r\n      params = {};\r\n    }\r\n\r\n    return { params };\r\n  });\r\n\r\n  restInstance.bindAction('create', function (data = {}) {\r\n    return { data };\r\n  });\r\n\r\n  restInstance.bindAction('fetch', function (id, params = {}) {\r\n    return {\r\n      params,\r\n      parseURL: (resourceURN) => `${resourceURN}/${id}`,\r\n    };\r\n  });\r\n\r\n  restInstance.bindAction('update', function (id, data = {}) {\r\n    return {\r\n      data,\r\n      parseURL: (resourceURN) => `${resourceURN}/${id}`,\r\n    };\r\n  });\r\n\r\n  restInstance.bindAction('delete', function (id, params = {}) {\r\n    return {\r\n      params,\r\n      parseURL: (resourceURN) => `${resourceURN}/${id}`,\r\n    };\r\n  });\r\n}\r\n\r\n/**\r\n * @param {Object.<string, *>} config\r\n * @returns {string}\r\n */\r\nfunction callCustomParseURL(config, resourceURN) {\r\n  if (typeof config.parseURL === 'function') {\r\n    return config.parseURL(resourceURN);\r\n  }\r\n\r\n  return resourceURN;\r\n}\r\n\r\n/**\r\n * @typedef RestOptions\r\n * @type {object}\r\n * @property {AxiosInstance} [axios]\r\n * @property {Object.<string, *>} [fetchAll]\r\n * @property {Object.<string, *>} [create]\r\n * @property {Object.<string, *>} [fetch]\r\n * @property {Object.<string, *>} [update]\r\n * @property {Object.<string, *>} [delete]\r\n */\r\n\r\n/**\r\n * @callback bindActionHandler\r\n * @param {...*} args\r\n * @returns {ActionConfig}\r\n */\r\n\r\n/**\r\n * @typedef ActionConfig\r\n * @type {object}\r\n * @property {Object.<string, *>} [params]\r\n * @property {Object.<string, *>} [data]\r\n * @property {parseURL} [parseURL]\r\n */\r\n\r\n/**\r\n * @callback parseURL\r\n * @param {string} resourceURN\r\n * @returns {string}\r\n */\r\n","import axios from 'axios';\r\n\r\nlet defaults = {\r\n  axios,\r\n\r\n  fetchAll: {\r\n    method: 'get',\r\n    params: {},\r\n  },\r\n\r\n  create: {\r\n    method: 'post',\r\n    data: {},\r\n  },\r\n\r\n  fetch: {\r\n    method: 'get',\r\n    params: {},\r\n  },\r\n\r\n  update: {\r\n    method: 'put',\r\n    data: {},\r\n  },\r\n\r\n  delete: {\r\n    method: 'delete',\r\n    data: {},\r\n  },\r\n};\r\n\r\nexport default defaults;\r\n","import Rest from './core/Rest';\r\nimport defaults from './defaults';\r\n\r\n/**\r\n * @typedef {import('./core/Rest.js').Rest} Rest\r\n * @typedef {import('./core/Rest.js').RestOptions} RestOptions\r\n */\r\n\r\n/**\r\n * @param {string} urn\r\n * @param {RestOptions} options\r\n * @returns {Rest}\r\n */\r\nexport default function rest(urn, options = {}) {\r\n  return new Rest(urn, {\r\n    ...cloneDefaultConfig(rest.defaults),\r\n    ...fastDeepClone(options),\r\n  });\r\n}\r\n\r\n/**\r\n * @var {RestOptions}\r\n */\r\nrest.defaults = defaults;\r\n\r\n/**\r\n * @param {Object} source\r\n * @returns {Object}\r\n */\r\nfunction cloneDefaultConfig(source) {\r\n  let config = (function ({ axios, ...config }) {\r\n    return config;\r\n  })(source);\r\n\r\n  return {\r\n    ...fastDeepClone(config),\r\n    axios: source.axios,\r\n  }\r\n}\r\n\r\n/**\r\n * @param {Object} source\r\n * @returns {Object}\r\n */\r\nfunction fastDeepClone(object) {\r\n  return JSON.parse(JSON.stringify(object));\r\n}\r\n"],"names":["mergeMap","method","url","data","params","mergeConfig","config1","config2","accessible","config","Object","entries","prop","value","isAccessible","mergeAccessible","args","assign","filter","captureAxiosError","handler","error","isAxiosError","captureStatusCode","code","expected","Array","isArray","status","response","includes","captureValidationError","brief","messageBag","BriefValidationMessageBag","ValidationMessageBag","_response","_message","_errors","message","errors","key","first","field","RestPromise","catchAxiosError","catchStatusCode","catchValidationError","Promise","wrap","promise","resolve","TypeError","Rest","urn","options","String","replace","axios","bindDefaultActions","bindAction","name","callable","Error","actionOptions","action","inputOptions","call","callCustomParseURL","lastQuery","request","restInstance","id","parseURL","resourceURN","defaults","fetchAll","create","fetch","update","rest","cloneDefaultConfig","fastDeepClone","source","object","JSON","parse","stringify"],"mappings":"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"}